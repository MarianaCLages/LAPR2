@startuml
autonumber
actor "Clinical Chemistry Technologist" as cct
participant ":RecordResultsUI" as UI
participant "RecordResultsController" as ctrl
participant ":Company" as Comp
participant ":TestStore" as tStore
participant ":Test" as Test
participant ":TestParameterStoreMapper" as tpStoreMapper
participant ":TestParameterStore" as tpStore
participant "testParam:TestParameter" as TestPa
participant "param:Parameter" as Param
participant "type:TestType" as TestTy
participant "em:ExternalModule" as ExMod
participant "refValue: ReferenceValue" as RefVal
participant "testResult:TestParameterResult" as TestParamRes


activate cct
cct -> UI: Asks for record the results of a given test
activate UI
UI --> cct: Asks for the code of the sample
deactivate UI
cct -> UI: Inserts the sample ID
activate UI
UI -> ctrl: getTestParameterList(sampleId)
      activate ctrl
      ctrl -> Comp: getTestStore()
      ctrl -> tStore: pList = getTestParametersList(sampleId)
      activate tStore
      tStore -> Test: pList = getTestParameterList()
      activate Test
      deactivate
      deactivate tStore

      ctrl -> tpStoreMapper: toDTO(pList)
      activate tpStoreMapper

      tpStoreMapper --> ctrl: tpStoreDTO
      deactivate tpStoreMapper
      return tpStoreDTO
      deactivate ctrl
      deactivate tStore
loop for all the parameters
    UI --> cct: Show parameters and asks to choose one
    deactivate UI
    cct -> UI: Choose parameter
    activate UI
    UI --> cct: Asks for results value
    deactivate UI
    cct -> UI: Types results value
    activate UI

    UI -> ctrl: addTestResult(parameterCode,result)
    activate ctrl
   ref over ctrl: addTestResult(parameterCode,result)
ctrl -> Test: changeState()
activate Test
Test -> Test: changeState()
activate Test
deactivate

Test --> ctrl: ok
deactivate
ctrl --> UI : ok
deactivate ctrl


UI --> cct: Show all data and show success
deactivate UI




@enduml